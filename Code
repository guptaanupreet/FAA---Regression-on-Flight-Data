*Importing Data Set FAA1;
%web_drop_table(BANA6043.FAA1);
FILENAME REFFILE '/folders/myfolders/BANA_6043/FAA1.xls';
PROC IMPORT DATAFILE=REFFILE
DBMS=XLS
OUT=BANA6043.FAA1;
GETNAMES=YES;
RUN;
PROC CONTENTS DATA=BANA6043.FAA1; RUN;

*Importing Data Set FAA2;
%web_drop_table(BANA6043.FAA2);
FILENAME REFFILE '/folders/myfolders/BANA_6043/FAA2.xls';
PROC IMPORT DATAFILE=REFFILE
DBMS=XLS
OUT=BANA6043.FAA2;
GETNAMES=YES;
RUN;
PROC CONTENTS DATA=BANA6043.FAA2; RUN; 

*Merging both the data sets; 
DATA BANA6043.FLIGHTS_COMBINED; 
SET BANA6043.FAA1 BANA6043.FAA2; RUN; 
PROC PRINT DATA=BANA6043.FLIGHTS_COMBINED (OBS=10); RUN;

*Removing missing observations (The data set currently has 50 missing observations);
DATA BANA6043.FLIGHTS_COMBINED;
SET BANA6043.FLIGHTS_COMBINED;
IF MISSING(NO_PASG) AND MISSING(DURATION) AND MISSING(AIRCRAFT) AND
MISSING(SPEED_GROUND)
AND MISSING(SPEED_AIR) AND MISSING(HEIGHT) AND MISSING(PITCH) AND
MISSING(DISTANCE)
THEN DELETE;
RUN;

PROC PRINT DATA=BANA6043.FLIGHTS_COMBINED;
RUN;
*Removing duplicates (There were 100 observations which were removed followed by this step);
PROC SORT DATA=BANA6043.FLIGHTS_COMBINED NODUPKEY;
BY AIRCRAFT NO_PASG SPEED_AIR SPEED_GROUND HEIGHT PITCH DISTANCE; 
PROC MEANS DATA=BANA6043.FLIGHTS_COMBINED N NMISS MEDIAN STDDEV QRANGE ;
TITLE Statistical Summary for Each Variable;


*Validity check on each variable; 
DATA BANA6043.FLIGHTS_COMBINED ; 
SET BANA6043.FLIGHTS_COMBINED ;
IF DURATION>=40 OR DURATION='' THEN IS_DURATION_ABNORMAL=0; 
ELSE IS_DURATION_ABNORMAL=1; 
IF SPEED_GROUND>=30 AND SPEED_GROUND<=140 THEN IS_SPEED_GROUND_ABNORMAL=0; 
ELSE IS_SPEED_GROUND_ABNORMAL=1; 
IF (SPEED_AIR>=30 AND SPEED_AIR<=140) OR (SPEED_AIR='') THEN IS_SPEED_AIR_ABNORMAL=0; 
ELSE IS_SPEED_AIR_ABNORMAL=1; 
IF HEIGHT>=6 THEN IS_HEIGHT_ABNORMAL=0; 
ELSE IS_HEIGHT_ABNORMAL=1; 
IF DISTANCE<=6000 THEN IS_DISTANCE_ABNORMAL=0; 
ELSE IS_DISTANCE_ABNORMAL=1; 
IF IS_DURATION_ABNORMAL + IS_SPEED_GROUND_ABNORMAL + IS_SPEED_AIR_ABNORMAL + IS_HEIGHT_ABNORMAL + IS_DISTANCE_ABNORMAL > 0 THEN IS_LANDING_ABNORMAL=1; 
ELSE IS_LANDING_ABNORMAL=0;
RUN;
*Created 5 new variables to flag the abnormality corresponding to each variable and another factor which collectively determines the abnormality; 

*Normal Landing Data; 
DATA BANA6043.FLIGHTS_COMBINED_NORMAL; 
SET BANA6043.FLIGHTS_COMBINED; 
IF IS_LANDING_ABNORMAL=0; 
PROC MEANS DATA=BANA6043.FLIGHTS_COMBINED_NORMAL;
TITLE NORMAL LANDING DATA;


*Working on missing values for duration; 
DATA BANA6043.FLIGHTS_COMBINED_NORMAL; 
SET BANA6043.FLIGHTS_COMBINED_NORMAL; 
IF DURATION='' THEN IS_DURATION_MISSING=1; 
ELSE IS_DURATION_MISSING=0; RUN; 

*Replacing missing values for duration with mean(duration) ; 
PROC STDIZE DATA=bana6043.FLIGHTS_COMBINED_NORMAL REPONLY METHOD=MEAN out=BANA6043.FLIGHTS_COMBINED_NORMAL ; 
VAR DURATION; RUN; 

*Statistical Summary after cleaning data set; 
PROC MEANS DATA=BANA6043.FLIGHTS_COMBINED_NORMAL N NMISS MEDIAN MODE MIN MAX Q1 Q3 QRANGE; 
TITLE Statistical Summary for Normal Data : Cleaned;

TITLE 'Landing Distance Vs Aircraft Type'; 
PROC BOXPLOT DATA=BANA6043.FLIGHTS_COMBINED_NORMAL; 
PLOT DISTANCE*AIRCRAFT; INSETGROUP MEAN MIN MAX N STDDEV / HEADER = 'EXTREMES BY AIRCRAFT' POS=TM; 
RUN; 

PROC UNIVARIATE DATA=BANA6043.FLIGHTS_COMBINED_NORMAL NOPRINT; 
CLASS AIRCRAFT; HISTOGRAM DISTANCE; RUN;

/* Plotting Landing Distance Vs. The Ground Speed*/ 
PROC SGPLOT DATA=BANA6043.FLIGHTS_COMBINED_NORMAL ; 
REG X=DISTANCE Y=SPEED_GROUND / LINEATTRS=(COLOR=RED THICKNESS=2); 
TITLE "SCATTER PLOT - REGRESSION LINE: LANDING DISTANCE VS GROUND SPEED"; RUN;

*CALCULATING THE CORRELATIONS; 
PROC CORR DATA=BANA6043.FLIGHTS_COMBINED_NORMAL; 
VAR DISTANCE SPEED_GROUND DURATION NO_PASG HEIGHT PITCH; 
RUN;

* Performing the regression analysis on complete data set; 
PROC REG DATA=BANA6043.FLIGHTS_COMBINED_NORMAL; 
MODEL DISTANCE=DURATION NO_PASG SPEED_GROUND HEIGHT PITCH; 
OUTPUT OUT=temp_reg r=resid; 
RUN;

PROC UNIVARIATE DATA=temp_reg NORMAL; 
VAR RESID; QQPLOT RESID /NORMAL(MU=EST SIGMA=EST COLOR=RED L=1); 
RUN;

* Performing the regression analysis on Airbus data set; 
DATA BANA6043.FLIGHTS_COMBINED_NORMAL_AIRBUS; 
SET BANA6043.FLIGHTS_COMBINED_NORMAL (where=(aircraft='airbus')); 
RUN; 
PROC REG DATA=BANA6043.FLIGHTS_COMBINED_NORMAL_AIRBUS; M
ODEL DISTANCE=DURATION NO_PASG SPEED_GROUND HEIGHT PITCH; 
OUTPUT OUT=temp_reg r=resid; 
RUN; 
PROC UNIVARIATE DATA=temp_reg NORMAL; 
VAR RESID; QQPLOT RESID /NORMAL(MU=EST SIGMA=EST COLOR=RED L=1); 
RUN;


* Performing the regression analysis on Boeing data set; 
DATA BANA6043.FLIGHTS_COMBINED_NORMAL_BOEING; 
SET BANA6043.FLIGHTS_COMBINED_NORMAL (where=(aircraft='boeing)); 
RUN; 

PROC REG DATA=BANA6043.FLIGHTS_COMBINED_NORMAL_ BOEING; 
MODEL DISTANCE=DURATION NO_PASG SPEED_GROUND HEIGHT PITCH; 
OUTPUT OUT=temp_reg r=resid; 
RUN; 

PROC UNIVARIATE DATA=temp_reg NORMAL; 
VAR RESID; QQPLOT RESID /NORMAL(MU=EST SIGMA=EST COLOR=RED L=1); 
RUN;
